# Change: ç³»ç»Ÿä¾èµ–ç®¡ç†é¢æ¿å®ç°

## Why

å½“å‰ Hagicode Desktop åœ¨éƒ¨ç½² Web æœåŠ¡æ—¶ï¼Œç”¨æˆ·ä¸»æœºç¯å¢ƒå¯èƒ½ç¼ºå°‘å¿…è¦çš„è¿è¡Œæ—¶ä¾èµ–é¡¹ï¼ˆå¦‚ .NET Runtimeï¼‰ã€‚è¿™å¯¼è‡´ï¼š

1. **ä¾èµ–çŠ¶æ€ä¸é€æ˜**ï¼šç”¨æˆ·æ— æ³•ç›´è§‚äº†è§£å½“å‰ä¸»æœºæ˜¯å¦å·²å®‰è£… Web æœåŠ¡æ‰€éœ€çš„è¿è¡Œæ—¶ç¯å¢ƒ
2. **ç¼ºå°‘å®‰è£…å¼•å¯¼**ï¼šå½“ä¾èµ–é¡¹ç¼ºå¤±æ—¶ï¼Œåº”ç”¨æ— æ³•æä¾›å®‰è£…æŒ‡å¼•æˆ–è‡ªåŠ¨åŒ–å®‰è£…æµç¨‹
3. **ç”¨æˆ·ä½“éªŒä¸ä½³**ï¼šç”¨æˆ·éœ€è¦æ‰‹åŠ¨æ£€æŸ¥å’Œå®‰è£…ä¾èµ–ï¼Œå¢åŠ äº†ä½¿ç”¨é—¨æ§›
4. **æ•…éšœæ’æŸ¥å›°éš¾**ï¼šWeb æœåŠ¡å¯åŠ¨å¤±è´¥æ—¶ï¼Œéš¾ä»¥å¿«é€Ÿå®šä½æ˜¯å¦ä¸ºä¾èµ–é¡¹ç¼ºå¤±å¯¼è‡´

æ­¤å˜æ›´åŠ å…¥ç³»ç»Ÿä¾èµ–æ£€æµ‹å’Œç®¡ç†èƒ½åŠ›ï¼Œæå‡ç”¨æˆ·ä½“éªŒå’Œé™ä½ä½¿ç”¨é—¨æ§›ã€‚

## What Changes

- **ADDED** ç³»ç»Ÿä¾èµ–æ£€æµ‹åŠŸèƒ½ï¼šè‡ªåŠ¨æ£€æµ‹ä¸»æœºæ˜¯å¦å®‰è£… .NET Runtime åŠå…¶ç‰ˆæœ¬
- **ADDED** ç‹¬ç«‹çš„ä¾èµ–ç®¡ç†é¢æ¿ç»„ä»¶ `DependencyManagementCard.tsx`
- **ADDED** ä¸»è¿›ç¨‹ä¾èµ–ç®¡ç†æ¨¡å— `dependency-manager.ts`ï¼Œæä¾›è·¨å¹³å°ä¾èµ–æ£€æµ‹èƒ½åŠ›
- **ADDED** IPC handlers æ”¯æŒä¾èµ–æ£€æŸ¥å’Œå®‰è£…æ“ä½œ
- **ADDED** Redux çŠ¶æ€ç®¡ç†ï¼ˆ`dependencySlice` å’Œ `dependencySaga`ï¼‰å¤„ç†ä¾èµ–çŠ¶æ€
- **ADDED** å›½é™…åŒ–æ”¯æŒï¼ˆä¸­æ–‡ã€è‹±æ–‡ï¼‰çš„ä¾èµ–ç®¡ç†ç›¸å…³ç¿»è¯‘
- **MODIFIED** `App.tsx` æ·»åŠ ä¾èµ–ç®¡ç†å¡ç‰‡ç»„ä»¶
- **MODIFIED** `main.ts` æ³¨å†Œä¾èµ–ç®¡ç†ç›¸å…³çš„ IPC handlers
- **MODIFIED** `preload/index.ts` æš´éœ²ä¾èµ–ç®¡ç† API ç»™æ¸²æŸ“è¿›ç¨‹

## UI Design Changes

### ä¾èµ–ç®¡ç†é¢æ¿å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ ç³»ç»Ÿä¾èµ–ç®¡ç†                                    [åˆ·æ–°]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ .NET Runtime (ASP.NET Core)            âœ… å·²å®‰è£…     â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚ ç‰ˆæœ¬: 8.0.11                                        â”‚   â”‚
â”‚  â”‚ è¦æ±‚: >= 8.0.0                                      â”‚   â”‚
â”‚  â”‚ çŠ¶æ€: ç‰ˆæœ¬åŒ¹é…                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Node.js Runtime                          âŒ æœªå®‰è£…    â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚ è¦æ±‚: >= 18.0.0                                     â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚ [ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…]    [è®¿é—®å®˜ç½‘ä¸‹è½½]                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç”¨æˆ·äº¤äº’æµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant R as Renderer Process
    participant M as Main Process
    participant S as System

    U->>R: æ‰“å¼€åº”ç”¨
    R->>M: dependency:check
    M->>S: æ‰§è¡Œ dotnet --list-runtimes
    S-->>M: è¿”å›è¿è¡Œæ—¶åˆ—è¡¨
    M-->>R: è¿”å›ä¾èµ–æ£€æµ‹ç»“æœ
    R->>U: æ˜¾ç¤ºä¾èµ–çŠ¶æ€

    U->>R: ç‚¹å‡»"å®‰è£…"æŒ‰é’®
    R->>M: dependency:install (dotnet)
    M->>S: æ‰§è¡Œ winget install dotnet
    S-->>M: å®‰è£…å®Œæˆ
    M->>S: é‡æ–°æ£€æŸ¥ä¾èµ–
    M-->>R: æ›´æ–°ä¾èµ–çŠ¶æ€
    R->>U: æ˜¾ç¤ºå®‰è£…æˆåŠŸæç¤º
```

## Code Flow Changes

### æ¶æ„æ¦‚è§ˆ

```mermaid
graph TB
    subgraph "Renderer Process"
        A[DependencyManagementCard] --> B[dependencySaga]
        B --> C[dependencySlice]
        C --> A
        A --> D[electronAPI]
    end

    subgraph "Main Process"
        E[dependency:check handler]
        F[dependency:install handler]
        G[DependencyManager]
    end

    subgraph "System"
        H[dotnet CLI]
        I[winget/brew/apt]
    end

    D -->|IPC| E
    D -->|IPC| F
    E --> G
    F --> G
    G --> H
    F --> I

    style A fill:#e1f5ff
    style G fill:#fff4e1
    style H fill:#f0f0f0
    style I fill:#f0f0f0
```

### ä¾èµ–æ£€æµ‹æ•°æ®æµ

```mermaid
flowchart TD
    A[åº”ç”¨å¯åŠ¨] --> B[åˆå§‹åŒ– DependencyManager]
    B --> C[è°ƒç”¨ checkAllDependencies]
    C --> D{æ£€æµ‹å¹³å°}

    D -->|Windows| E[æ‰§è¡Œ dotnet --list-runtimes]
    D -->|macOS/Linux| F[æ‰§è¡Œ dotnet --list-runtimes]

    E --> G[è§£æè¾“å‡º]
    F --> G

    G --> H{ç‰ˆæœ¬æ¯”è¾ƒ}
    H -->|å·²å®‰è£…ä¸”ç‰ˆæœ¬åŒ¹é…| I[è¿”å› installed=true]
    H -->|å·²å®‰è£…ä½†ç‰ˆæœ¬ä¸åŒ¹é…| J[è¿”å› installed=false, versionMismatch=true]
    H -->|æœªå®‰è£…| K[è¿”å› installed=false]

    I --> L[æ›´æ–° Redux Store]
    J --> L
    K --> L

    L --> M[æ¸²æŸ“ UI]
```

## Impact

### å—å½±å“çš„è§„èŒƒ
- **specs/dependency-management/spec.md** (æ–°å¢) - ç³»ç»Ÿä¾èµ–ç®¡ç†èƒ½åŠ›è§„èŒƒ

### å—å½±å“çš„ä»£ç 
- `src/main/dependency-manager.ts` (æ–°å¢) - ä¾èµ–æ£€æµ‹å’Œç®¡ç†é€»è¾‘
- `src/main/main.ts` (ä¿®æ”¹) - æ·»åŠ  IPC handlers
- `src/preload/index.ts` (ä¿®æ”¹) - æš´éœ²ä¾èµ–ç®¡ç† API
- `src/renderer/components/DependencyManagementCard.tsx` (æ–°å¢) - ä¾èµ–ç®¡ç† UI ç»„ä»¶
- `src/renderer/store/slices/dependencySlice.ts` (æ–°å¢) - ä¾èµ–çŠ¶æ€ç®¡ç†
- `src/renderer/store/sagas/dependencySaga.ts` (æ–°å¢) - ä¾èµ–å‰¯ä½œç”¨å¤„ç†
- `src/renderer/App.tsx` (ä¿®æ”¹) - é›†æˆä¾èµ–ç®¡ç†å¡ç‰‡
- `src/renderer/i18n/locales/*/components.json` (ä¿®æ”¹) - æ·»åŠ ç¿»è¯‘

### ç”¨æˆ·ä½“éªŒå½±å“
- **æ­£é¢å½±å“**ï¼šé™ä½ä½¿ç”¨é—¨æ§›ï¼Œè‡ªåŠ¨æ£€æµ‹å¹¶å¼•å¯¼å®‰è£…ä¾èµ–
- **æ­£é¢å½±å“**ï¼šæ•…éšœå¿«é€Ÿå®šä½ï¼Œæ˜ç¡®æ˜¾ç¤ºä¾èµ–çŠ¶æ€
- **æ­£é¢å½±å“**ï¼šç»Ÿä¸€ç®¡ç†ç•Œé¢ï¼Œæ‰€æœ‰ä¾èµ–é¡¹åœ¨ä¸€ä¸ªé¢æ¿ä¸­é›†ä¸­ç®¡ç†
- **æ½œåœ¨é£é™©**ï¼šè‡ªåŠ¨å®‰è£…ä¾èµ–å¯èƒ½éœ€è¦ç®¡ç†å‘˜æƒé™ï¼ˆé€šè¿‡ UAC æç¤ºå¤„ç†ï¼‰

### æŠ€æœ¯å€ºåŠ¡
- **ç»´æŠ¤æˆæœ¬**ï¼šéœ€è¦ç»´æŠ¤ä¾èµ–æ£€æµ‹å’Œå®‰è£…é€»è¾‘
- **å¹³å°é€‚é…**ï¼šéœ€è¦æµ‹è¯•ä¸åŒæ“ä½œç³»ç»Ÿä¸‹çš„æ£€æµ‹å’Œå®‰è£…è¡Œä¸º
- **ç‰ˆæœ¬å…¼å®¹æ€§**ï¼šéœ€è¦è·Ÿè¿› .NET Runtime çš„ç‰ˆæœ¬æ›´æ–°

### åç»­æ‰©å±•
- æ”¯æŒ Node.js ä¾èµ–æ£€æµ‹
- æ”¯æŒ Java Runtime æ£€æµ‹
- æ”¯æŒ Docker ä¾èµ–æ£€æµ‹
- æ·»åŠ æ›´å¤šåŒ…ç®¡ç†å™¨æ”¯æŒï¼ˆchocolateyã€snap ç­‰ï¼‰
