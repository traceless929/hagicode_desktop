# Tasks: 重构应用布局为侧边栏导航模式

**Change ID:** `sidebar-navigation-layout-refactor`
**Status:** Completed
**Created:** 2026-02-05
**Completed:** 2026-02-05

---

## 任务概览 (Overview)

本任务清单将侧边栏导航重构工作分解为可执行的小步骤，每个任务都应该是可验证的、能带来可见进展的工作项。

### 执行策略

1. **先组件后集成** - 先完成侧边栏组件开发，再集成到主应用
2. **并行优先** - 主进程调整和侧边栏组件可并行开发
3. **持续验证** - 每个阶段完成后进行功能验证
4. **渐进重构** - 保持应用始终可用，逐步替换导航系统

---

## Phase 1: 准备工作和设计确认

### 1.1 设计审查
- [ ] **Task 1.1.1**: 阅读 `design.md` 文档
  - 理解侧边栏组件设计和布局架构
  - 理解数据流和组件交互
  - 验证: 已阅读设计文档，无疑问
  - 依赖: 无
  - 预计时间: 15 分钟

- [ ] **Task 1.1.2**: 审查现有导航代码
  - 阅读 `src/renderer/components/TopNavigation.tsx`
  - 阅读 `src/main/menu-manager.ts`
  - 阅读 `src/renderer/store/slices/viewSlice.ts`
  - 验证: 理解现有导航逻辑和数据流
  - 依赖: Task 1.1.1
  - 预计时间: 20 分钟

### 1.2 技术方案确认
- [ ] **Task 1.2.1**: 确认 shadcn/ui 组件可用性
  - 检查项目中是否已安装 `Collapsible` 或 `Sheet` 组件
  - 如未安装，确认需要添加的组件
  - 验证: 明确需要使用的 shadcn/ui 组件列表
  - 依赖: 无
  - 预计时间: 10 分钟

- [ ] **Task 1.2.2**: 确认图标库
  - 确认项目中已安装 Lucide React
  - 准备替换 emoji 图标为 Lucide 图标的映射表
  - 验证: 图标映射表完成
  - 依赖: 无
  - 预计时间: 10 分钟

---

## Phase 2: 侧边栏组件开发

### 2.1 基础侧边栏组件
- [ ] **Task 2.1.1**: 创建 `SidebarNavigation.tsx` 文件
  - 路径: `src/renderer/components/SidebarNavigation.tsx`
  - 设置基本组件结构和 props 类型
  - 验证: 文件创建完成，TypeScript 编译无错误
  - 依赖: Task 1.1.2
  - 预计时间: 10 分钟

- [ ] **Task 2.1.2**: 实现侧边栏容器和样式
  - 实现左侧固定布局（`w-64`, `h-screen`, `fixed` 等）
  - 应用深色主题样式（与现有 `bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900` 一致）
  - 添加右侧边框分隔内容区
  - 验证: 侧边栏在左侧正确显示，样式正确
  - 依赖: Task 2.1.1
  - 预计时间: 30 分钟

- [ ] **Task 2.1.3**: 实现导航项列表
  - 从 `TopNavigation` 迁移导航项配置
  - 使用 Lucide React 图标替换 emoji
  - 实现导航项的基本渲染（图标 + 标签）
  - 验证: 四个导航项（系统管理、Web 服务、依赖管理、版本管理）正确显示
  - 依赖: Task 2.1.2, Task 1.2.2
  - 预计时间: 30 分钟

### 2.2 导航交互实现
- [ ] **Task 2.2.1**: 实现视图切换逻辑
  - 集成 Redux `viewSlice` 的 `switchView` action
  - 添加点击事件处理
  - 实现 Web 服务视图的禁用状态（当 `webServiceUrl` 为 null 时）
  - 验证: 点击导航项能正确切换视图，禁用状态正常
  - 依赖: Task 2.1.3
  - 预计时间: 20 分钟

- [ ] **Task 2.2.2**: 实现当前视图高亮
  - 根据当前视图状态应用激活样式
  - 添加视觉反馈（背景色、左侧指示条等）
  - 验证: 当前视图对应的导航项有明确的高亮显示
  - 依赖: Task 2.2.1
  - 预计时间: 20 分钟

- [ ] **Task 2.2.3**: 实现 tooltip 提示
  - 为禁用的 Web 服务导航项添加 tooltip
  - 提示内容: "Web 服务未运行，无法访问"
  - 验证: 悬停在禁用项上显示正确的提示信息
  - 依赖: Task 2.2.1
  - 预计时间: 15 分钟

### 2.3 折叠/展开功能
- [ ] **Task 2.3.1**: 实现折叠状态管理
  - 添加 `collapsed` 状态（使用 useState 或 Redux）
  - 实现切换按钮（折叠/展开图标）
  - 验证: 点击切换按钮能切换侧边栏状态
  - 依赖: Task 2.2.2
  - 预计时间: 30 分钟

- [ ] **Task 2.3.2**: 实现折叠动画
  - 使用 CSS transition 实现平滑过渡
  - 折叠状态显示仅图标，展开状态显示图标 + 标签
  - 验证: 折叠/展开动画流畅（60fps）
  - 依赖: Task 2.3.1
  - 预计时间: 30 分钟

- [ ] **Task 2.3.3**: 实现键盘快捷键
  - 添加 `Ctrl/Cmd + B` 快捷键监听
  - 绑定到折叠/展开切换功能
  - 验证: 按下快捷键能切换侧边栏状态
  - 依赖: Task 2.3.1
  - 预计时间: 15 分钟

### 2.4 Logo 和头部
- [ ] **Task 2.4.1**: 实现 Logo 区域
  - 从 `TopNavigation` 迁移 Logo 设计（Hagicode Desktop + H 图标）
  - 在折叠状态下简化显示（仅 H 图标）
  - 验证: Logo 在展开和折叠状态下都正确显示
  - 依赖: Task 2.3.2
  - 预计时间: 30 分钟

---

## Phase 3: 主进程调整

### 3.1 禁用原生菜单栏
- [ ] **Task 3.1.1**: 修改 `main.ts` 窗口配置
  - 在 `BrowserWindow` 配置中添加 `autoHideMenuBar: true`
  - 验证: 应用启动后原生菜单栏已隐藏
  - 依赖: Task 1.1.2
  - 预计时间: 5 分钟

- [ ] **Task 3.1.2**: 测试菜单栏隐藏功能
  - 在 Windows/macOS/Linux 三平台验证
  - 确认按 `Alt` 键可以临时显示菜单（Windows/Linux）
  - 验证: 所有平台表现符合预期
  - 依赖: Task 3.1.1
  - 预计时间: 15 分钟

### 3.2 简化 MenuManager
- [ ] **Task 3.2.1**: 移除 MenuManager 中的视图切换逻辑
  - 删除 `viewMenu` 和 `systemManagementMenu` 的视图切换功能
  - 移除 `switchView` 方法（保留 webview 导航功能）
  - 移除 `view-changed` IPC 事件发送
  - 验证: MenuManager 代码已简化，无视图切换逻辑
  - 依赖: Task 3.1.1
  - 预计时间: 30 分钟

- [ ] **Task 3.2.2**: 保留必要的系统菜单
  - 保留 macOS 应用菜单（About、Settings、Quit）
  - 保留 Help 菜单（About）
  - 保留 Web 视图导航菜单（后退、前进、刷新、开发者工具）
  - 验证: 必要菜单项保留，非必要项已移除
  - 依赖: Task 3.2.1
  - 预计时间: 20 分钟

- [ ] **Task 3.2.3**: 移除 IPC 事件监听器
  - 在 `App.tsx` 中移除 `onViewChange` 监听器（如不再需要）
  - 验证: 应用中不再监听 `view-changed` 事件
  - 依赖: Task 3.2.1
  - 预计时间: 10 分钟

---

## Phase 4: 布局重构和集成

### 4.1 App.tsx 重构
- [ ] **Task 4.1.1**: 移除 TopNavigation 组件引用
  - 在 `App.tsx` 中删除 `TopNavigation` 导入
  - 删除 `<TopNavigation />` 组件使用
  - 验证: 应用编译通过，无 TopNavigation 相关引用
  - 依赖: Task 2.3.2
  - 预计时间: 5 分钟

- [ ] **Task 4.1.2**: 添加 SidebarNavigation 组件
  - 导入 `SidebarNavigation` 组件
  - 添加 `<SidebarNavigation />` 到布局
  - 验证: 侧边栏在应用中正确显示
  - 依赖: Task 4.1.1
  - 预计时间: 10 分钟

- [ ] **Task 4.1.3**: 调整主内容区域布局
  - 将主容器从垂直布局改为水平布局（flex-row）
  - 为内容区域添加左侧 margin（`ml-64` 展开状态，`ml-16` 折叠状态）
  - 调整容器样式以适应侧边栏布局
  - 验证: 内容区域不被侧边栏遮挡，布局正常
  - 依赖: Task 4.1.2
  - 预计时间: 30 分钟

### 4.2 响应式布局优化
- [ ] **Task 4.2.1**: 实现侧边栏状态同步
  - 确保内容区域 margin 与侧边栏状态同步
  - 添加过渡动画使内容区域平滑调整
  - 验证: 折叠/展开侧边栏时，内容区域平滑过渡
  - 依赖: Task 4.1.3
  - 预计时间: 20 分钟

- [ ] **Task 4.2.2**: 测试不同窗口尺寸
  - 测试窗口最小化、最大化、全屏状态
  - 测试调整窗口大小时侧边栏表现
  - 验证: 所有窗口尺寸下侧边栏和内容区域表现正常
  - 依赖: Task 4.2.1
  - 预计时间: 20 分钟

---

## Phase 5: 国际化和清理

### 5.1 翻译文件更新
- [ ] **Task 5.1.1**: 添加侧边栏翻译 key
  - 在 `src/renderer/i18n/locales/zh-CN/common.json` 添加:
    - `sidebar.dashboard`: "仪表盘"
    - `sidebar.webService`: "Web 服务"
    - `sidebar.dependencyManagement`: "依赖项管理"
    - `sidebar.versionManagement`: "版本管理"
    - `sidebar.toggle`: "切换侧边栏"
    - `sidebar.collapse`: "收起"
    - `sidebar.expand`: "展开"
  - 验证: 中文翻译添加完成
  - 依赖: Task 2.1.3
  - 预计时间: 10 分钟

- [ ] **Task 5.1.2**: 添加英文翻译
  - 在 `src/renderer/i18n/locales/en-US/common.json` 添加对应的英文翻译
  - 验证: 英文翻译添加完成
  - 依赖: Task 5.1.1
  - 预计时间: 10 分钟

- [ ] **Task 5.1.3**: 移除菜单相关翻译
  - 删除 `menu` 部分中不再需要的翻译 key
  - 保留 Web 视图相关的翻译（`webView` 部分）
  - 验证: 无用翻译已清理
  - 依赖: Task 3.2.2
  - 预计时间: 10 分钟

### 5.2 代码清理
- [ ] **Task 5.2.1**: 删除 TopNavigation.tsx 文件
  - 路径: `src/renderer/components/TopNavigation.tsx`
  - 验证: 文件已删除，应用无编译错误
  - 依赖: Task 4.1.1
  - 预计时间: 2 分钟

- [ ] **Task 5.2.2**: 清理 MenuManager 中废弃的翻译接口
  - 删除 `MenuTranslations` 接口中不再使用的字段
  - 更新 `getTranslations` 方法
  - 验证: MenuManager 编译通过，无 TypeScript 错误
  - 依赖: Task 3.2.2
  - 预计时间: 15 分钟

- [ ] **Task 5.2.3**: 清理未使用的导入和变量
  - 在 `App.tsx` 中清理未使用的导入
  - 在 `MenuManager` 中清理未使用的方法
  - 验证: 所有文件无未使用的导入或变量警告
  - 依赖: Task 5.2.1
  - 预计时间: 10 分钟

---

## Phase 6: 测试和验证

### 6.1 功能测试
- [ ] **Task 6.1.1**: 视图切换测试
  - 测试所有四个视图的切换（系统管理、Web 服务、依赖管理、版本管理）
  - 验证: 所有视图能正确切换，无渲染错误
  - 依赖: Task 4.1.3
  - 预计时间: 15 分钟

- [ ] **Task 6.1.2**: 侧边栏折叠/展开测试
  - 测试点击切换按钮
  - 测试键盘快捷键（`Ctrl/Cmd + B`）
  - 验证: 两种方式都能正常切换，动画流畅
  - 依赖: Task 4.2.1
  - 预计时间: 10 分钟

- [ ] **Task 6.1.3**: Web 服务禁用状态测试
  - 停止 Web 服务后测试导航项禁用状态
  - 验证: 禁用状态正确显示，tooltip 提示正确
  - 依赖: Task 2.2.3
  - 预计时间: 10 分钟

- [ ] **Task 6.1.4**: 窗口状态测试
  - 测试窗口最小化、最大化、全屏
  - 测试窗口大小调整
  - 验证: 所有状态下布局正确，无遮挡或错位
  - 依赖: Task 4.2.2
  - 预计时间: 15 分钟

### 6.2 跨平台测试
- [ ] **Task 6.2.1**: Windows 平台测试
  - 验证菜单栏隐藏（`autoHideMenuBar`）
  - 验证 `Alt` 键临时显示菜单
  - 验证侧边栏所有功能
  - 验证: 所有功能正常，符合 Windows 规范
  - 依赖: Task 6.1.4
  - 预计时间: 20 分钟

- [ ] **Task 6.2.2**: macOS 平台测试（如可访问）
  - 验证菜单栏隐藏
  - 验证应用菜单保留（About、Settings、Quit）
  - 验证侧边栏所有功能
  - 验证: 所有功能正常，符合 macOS 规范
  - 依赖: Task 6.1.4
  - 预计时间: 20 分钟

- [ ] **Task 6.2.3**: Linux 平台测试（如可访问）
  - 验证菜单栏隐藏
  - 验证 `Alt` 键临时显示菜单
  - 验证侧边栏所有功能
  - 验证: 所有功能正常，符合 Linux 规范
  - 依赖: Task 6.1.4
  - 预计时间: 20 分钟

### 6.3 国际化测试
- [ ] **Task 6.3.1**: 中文界面测试
  - 切换到中文语言
  - 验证所有侧边栏文本正确显示
  - 验证: 无乱码或缺失翻译
  - 依赖: Task 5.1.1
  - 预计时间: 10 分钟

- [ ] **Task 6.3.2**: 英文界面测试
  - 切换到英文语言
  - 验证所有侧边栏文本正确显示
  - 验证: 无乱码或缺失翻译
  - 依赖: Task 5.1.2
  - 预计时间: 10 分钟

### 6.4 性能和回归测试
- [ ] **Task 6.4.1**: 性能验证
  - 测试侧边栏折叠/展开动画帧率（应保持 60fps）
  - 测试视图切换响应时间（应 < 100ms）
  - 验证: 性能指标达标，无卡顿
  - 依赖: Task 6.1.2
  - 预计时间: 15 分钟

- [ ] **Task 6.4.2**: 回归测试
  - 测试所有现有功能（服务管理、包管理、版本管理等）
  - 验证: 所有现有功能正常，无破坏性变更
  - 依赖: Task 6.1.1
  - 预计时间: 30 分钟

---

## 并行机会 (Parallelization Opportunities)

以下任务可以并行执行以加速开发：

1. **Phase 2 & Phase 3** - 侧边栏组件开发（Task 2.x）和主进程调整（Task 3.x）可完全并行
2. **Task 2.4.1 & Task 2.3.3** - Logo 实现和快捷键实现可并行
3. **Task 5.1.1 & Task 5.2.1** - 翻译更新和文件删除可并行
4. **Task 6.2.1, 6.2.2, 6.2.3** - 跨平台测试可并行进行

## 关键路径 (Critical Path)

如果时间紧迫，以下是必须按顺序完成的核心路径：

```
Task 1.1.2 → Task 2.1.1 → Task 2.1.2 → Task 2.1.3 → Task 2.2.1 → Task 2.2.2
→ Task 2.3.1 → Task 2.3.2 → Task 4.1.1 → Task 4.1.2 → Task 4.1.3 → Task 4.2.1
→ Task 5.1.1 → Task 5.1.2 → Task 6.1.1 → Task 6.1.2 → Task 6.4.2
```

## 风险任务 (Risky Tasks)

以下任务风险较高，需要特别注意：

| 任务 | 风险 | 缓解措施 |
|------|------|----------|
| Task 2.3.2 | CSS 过渡动画可能在某些平台不流畅 | 使用 CSS transform 而非 width 实现动画 |
| Task 3.2.1 | 移除视图切换逻辑可能影响 Web 视图导航 | 仔细区分视图切换和 Web 视图导航，保留后者 |
| Task 4.1.3 | 布局调整可能导致内容区域错位 | 在多个窗口尺寸下充分测试 |
| Task 4.2.1 | 侧边栏状态同步可能不及时 | 使用状态管理工具（Redux）确保状态一致性 |
| Task 6.2.2 | macOS 测试环境可能不可用 | 使用 GitHub Actions macOS runner 验证 |

## 总时间估算

| Phase | 预计时间 | 可并行 |
|-------|---------|--------|
| Phase 1 | 0.8 小时 | 否 |
| Phase 2 | 4.5 小时 | 部分可并行 |
| Phase 3 | 1.3 小时 | 部分可并行 |
| Phase 4 | 1.7 小时 | 否 |
| Phase 5 | 1 小时 | 部分可并行 |
| Phase 6 | 2.5 小时 | 部分可并行 |
| **总计** | **11.8 小时** | **优化后 ~8-9 小时** |

---

## 验收清单 (Acceptance Checklist)

完成所有任务后，使用此清单进行最终验收：

- [ ] 侧边栏在所有视图下正常显示
- [ ] 所有导航项可点击并正确切换视图
- [ ] Web 服务导航项在服务未运行时正确禁用
- [ ] 侧边栏折叠/展开功能正常，动画流畅
- [ ] 键盘快捷键（`Ctrl/Cmd + B`）正常工作
- [ ] 原生菜单栏已隐藏
- [ ] MenuManager 中视图切换逻辑已移除
- [ ] 布局在不同窗口尺寸下正常
- [ ] 中英文界面都正确显示
- [ ] 所有现有功能正常工作（无破坏性变更）
- [ ] Windows/macOS/Linux 三平台表现一致
- [ ] 无控制台错误或警告

## 变更历史

| 日期 | 变更说明 |
|------|----------|
| 2026-02-05 | 初始任务清单 |
