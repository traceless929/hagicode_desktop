# Change: æ·»åŠ è‡ªå®šä¹‰HTTPç´¢å¼•åŒ…æºæ”¯æŒ

## Why

å½“å‰ç³»ç»Ÿä»…æ”¯æŒæœ¬åœ°æ–‡ä»¶å¤¹å’ŒGitHub Releasesä¸¤ç§åŒ…æºç±»å‹ã€‚ä¸ºäº†æ‰©å±•åŒ…æºçš„çµæ´»æ€§ï¼Œéœ€è¦æ”¯æŒä»è‡ªå®šä¹‰HTTPæœåŠ¡å™¨è·å–åŒ…ç´¢å¼•å’Œä¸‹è½½åŒ…æ–‡ä»¶çš„èƒ½åŠ›ã€‚è¿™å…è®¸ç”¨æˆ·é…ç½®è‡ªå·±çš„CDNæˆ–æ–‡ä»¶æœåŠ¡å™¨ä½œä¸ºåŒ…æºï¼Œæä¾›æ›´å¥½çš„éƒ¨ç½²çµæ´»æ€§å’Œè‡ªå®šä¹‰é€‰é¡¹ã€‚

## What Changes

- **æ–°å¢åŒ…æºç±»å‹**: æ·»åŠ  `http-index` ç±»å‹çš„åŒ…æºé…ç½®
- **åç«¯å®ç°**: åˆ›å»º `HttpIndexPackageSource` ç±»å®ç° `PackageSource` æ¥å£
- **å‰ç«¯UI**: åœ¨åŒ…æºé€‰æ‹©å™¨ä¸­æ·»åŠ HTTPç´¢å¼•æºçš„é…ç½®è¡¨å•
- **çŠ¶æ€ç®¡ç†**: æ‰©å±•Redux storeå’Œsagaä»¥æ”¯æŒæ–°åŒ…æºç±»å‹
- **é…ç½®æŒä¹…åŒ–**: æ›´æ–°é…ç½®ç®¡ç†å™¨ä»¥æ”¯æŒæ–°ç±»å‹çš„å­˜å‚¨

## UI Design Changes

### åŒ…æºé€‰æ‹©å™¨UIæ‰©å±•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¦ åŒ…æºç®¡ç†                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚ é€‰æ‹©æºç±»å‹:                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ ğŸ“ æœ¬åœ°æ–‡ä»¶å¤¹                                      â”‚  â”‚
â”‚ â”‚ ğŸ™ GitHub Releases                                 â”‚  â”‚
â”‚ â”‚ ğŸŒ HTTP ç´¢å¼•æº [æ–°å¢]                              â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                           â”‚
â”‚ å½“é€‰æ‹© "HTTP ç´¢å¼•æº" æ—¶æ˜¾ç¤º:                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ ç´¢å¼•URL *                                          â”‚  â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
â”‚ â”‚ â”‚ https://server.dl.hagicode.com/index.json       â”‚â”‚  â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
â”‚ â”‚                                                    â”‚  â”‚
â”‚ â”‚ ä¸‹è½½URLå‰ç¼€ (å¯é€‰)                                  â”‚  â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
â”‚ â”‚ â”‚ https://server.dl.hagicode.com/                 â”‚â”‚  â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
â”‚ â”‚                                                    â”‚  â”‚
â”‚ â”‚ è®¤è¯ä»¤ç‰Œ (å¯é€‰)                                     â”‚  â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
â”‚ â”‚ â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢                                â”‚â”‚  â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
â”‚ â”‚                                                    â”‚  â”‚
â”‚ â”‚ â„¹ï¸ ç´¢å¼•æ–‡ä»¶å¿…é¡»åŒ…å«versionsæ•°ç»„å’Œæ¯ä¸ªç‰ˆæœ¬çš„assets    â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                           â”‚
â”‚              [ ä¿å­˜é…ç½® ]                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç”¨æˆ·äº¤äº’æµç¨‹

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant UI as åŒ…æºé€‰æ‹©å™¨
    participant Saga as Redux Saga
    participant Main as ä¸»è¿›ç¨‹
    participant HTTP as HTTPæœåŠ¡å™¨

    User->>UI: é€‰æ‹©"HTTP ç´¢å¼•æº"
    UI->>UI: æ˜¾ç¤ºHTTPé…ç½®è¡¨å•
    User->>UI: è¾“å…¥ç´¢å¼•URL
    User->>UI: ç‚¹å‡»"ä¿å­˜é…ç½®"
    UI->>Saga: SET_SOURCE_CONFIG
    Saga->>Main: validateConfig(config)
    Main->>HTTP: GET index.json
    HTTP-->>Main: ç´¢å¼•æ•°æ®
    Main-->>Saga: {success: true}
    Saga->>Main: switchSource(sourceId)
    Main-->>Saga: {success: true}
    Saga-->>UI: æ›´æ–°å½“å‰é…ç½®
    UI-->>User: æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
```

### é”™è¯¯å¤„ç†UIçŠ¶æ€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ é…ç½®éªŒè¯å¤±è´¥                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚ æ— æ³•è·å–ç´¢å¼•æ–‡ä»¶:                                         â”‚
â”‚ â€¢ ç´¢å¼•URLè¿”å›404é”™è¯¯                                      â”‚
â”‚ â€¢ è¯·æ£€æŸ¥URLæ˜¯å¦æ­£ç¡®å¹¶å¯è®¿é—®                               â”‚
â”‚                                                           â”‚
â”‚              [ é‡è¯• ]  [ è¿”å› ]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Code Flow Changes

### æ¶æ„æ¦‚è§ˆ

```mermaid
graph TB
    subgraph "å‰ç«¯æ¸²æŸ“è¿›ç¨‹"
        UI[PackageSourceSelector]
        Saga[packageSourceSaga]
        Slice[packageSourceSlice]
    end

    subgraph "ä¸»è¿›ç¨‹"
        IPC[IPC Handlers]
        Config[PackageSourceConfigManager]
        Factory[createPackageSource]
    end

    subgraph "HTTPç´¢å¼•æº"
        HttpIndex[HttpIndexPackageSource]
    end

    subgraph "å¤–éƒ¨æœåŠ¡"
        Server[HTTPæœåŠ¡å™¨]
    end

    UI -->|dispatch actions| Saga
    Saga -->|update state| Slice
    Saga -->|IPC calls| IPC
    IPC -->|get/set config| Config
    IPC -->|create instance| Factory
    Factory -->|type: http-index| HttpIndex
    HttpIndex -->|GET index.json| Server
    HttpIndex -->|download assets| Server
```

### HTTPç´¢å¼•æºæ•°æ®æµ

```mermaid
flowchart TD
    Start[ç”¨æˆ·é…ç½®HTTPç´¢å¼•æº] --> Validate[éªŒè¯é…ç½®]
    Validate -->|æœ‰æ•ˆ| FetchIndex[è·å–index.json]
    Validate -->|æ— æ•ˆ| ShowError[æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯]

    FetchIndex --> Parse[è§£æç´¢å¼•æ•°æ®]
    Parse --> Filter[è¿‡æ»¤å½“å‰å¹³å°ç‰ˆæœ¬]
    Filter --> Cache[ç¼“å­˜ç‰ˆæœ¬åˆ—è¡¨]
    Cache --> Return[è¿”å›ç‰ˆæœ¬åˆ—è¡¨]

    Download[ä¸‹è½½åŒ…] --> GetURL[è·å–ä¸‹è½½URL]
    GetURL --> Combine[ç»„åˆbaseURL + asset.path]
    Combine --> HTTPDownload[HTTPä¸‹è½½]
    HTTPDownload --> Save[ä¿å­˜åˆ°ç¼“å­˜]
    Save --> Complete[ä¸‹è½½å®Œæˆ]
```

### ç»„ä»¶äº¤äº’åºåˆ—

```mermaid
sequenceDiagram
    participant F as å‰ç«¯ç»„ä»¶
    participant S as Redux Store
    participant I as IPC Bridge
    participant C as ConfigManager
    participant H as HttpIndexPackageSource
    participant Server as HTTP Server

    Note over F,Server: é…ç½®é˜¶æ®µ
    F->>S: dispatch SET_SOURCE_CONFIG
    S->>I: electronAPI.packageSource.setConfig
    I->>C: addSource/updateSource
    C-->>I: StoredPackageSourceConfig
    I-->>S: {success: true}
    S->>F: æ›´æ–°UIçŠ¶æ€

    Note over F,Server: è·å–ç‰ˆæœ¬åˆ—è¡¨
    F->>S: dispatch FETCH_HTTP_INDEX
    S->>I: electronAPI.packageSource.fetchHttpIndex
    I->>H: listAvailableVersions()
    H->>Server: GET {indexUrl}
    Server-->>H: JSONæ•°æ®
    H->>H: è§£æå¹¶è¿‡æ»¤ç‰ˆæœ¬
    H-->>I: Version[]
    I-->>S: {success, versions}
    S->>F: æ›´æ–°ç‰ˆæœ¬åˆ—è¡¨

    Note over F,Server: ä¸‹è½½åŒ…
    F->>S: dispatch DOWNLOAD_PACKAGE
    S->>I: electronAPI.versionManager.download
    I->>H: downloadPackage(version, path)
    H->>Server: GET {baseUrl}/{asset.path}
    Server-->>H: æ–‡ä»¶æµ
    H->>H: å†™å…¥ç¼“å­˜è·¯å¾„
    H-->>I: å®Œæˆ
    I-->>S: {success}
```

## Impact

### Affected specs
- `package-source-management` - æ·»åŠ æ–°çš„åŒ…æºç±»å‹æ”¯æŒ

### Affected code
**åç«¯ (ä¸»è¿›ç¨‹)**:
- `src/main/package-source-config-manager.ts` - æ‰©å±•ç±»å‹å®šä¹‰æ”¯æŒ `http-index`
- `src/main/package-sources/package-source.ts` - æ·»åŠ æ–°ç±»å‹å’Œæ¥å£
- `src/main/package-sources/index.ts` - æ³¨å†Œæ–°çš„åŒ…æºå·¥å‚
- `src/main/package-sources/http-index-source.ts` - æ–°å¢HTTPç´¢å¼•æºå®ç°
- `src/main/main.ts` - æ³¨å†Œæ–°çš„IPCå¤„ç†å™¨

**å‰ç«¯ (æ¸²æŸ“è¿›ç¨‹)**:
- `src/renderer/components/PackageSourceSelector.tsx` - æ·»åŠ HTTPç´¢å¼•é…ç½®UI
- `src/renderer/store/slices/packageSourceSlice.ts` - æ·»åŠ HTTPç´¢å¼•è¡¨å•çŠ¶æ€
- `src/renderer/store/sagas/packageSourceSaga.ts` - æ·»åŠ HTTPç´¢å¼•ç›¸å…³saga

**ç±»å‹å®šä¹‰**:
- `src/preload/index.ts` - æ‰©å±•electronAPIç±»å‹

**å›½é™…åŒ–**:
- `src/renderer/i18n/locales/*/components.json` - æ·»åŠ HTTPç´¢å¼•ç›¸å…³ç¿»è¯‘

### Breaking Changes
æ— ç ´åæ€§å˜æ›´ã€‚æ–°åŠŸèƒ½ä¸ºçº¯æ·»åŠ ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½ã€‚

### Dependencies
- ç°æœ‰ä¾èµ–: `axios` (å·²ä½¿ç”¨äºGitHubæº)
- æ— æ–°å¢å¤–éƒ¨ä¾èµ–

### Migration
æ— éœ€æ•°æ®è¿ç§»ã€‚æ–°é…ç½®ç±»å‹å‘åå…¼å®¹ã€‚
