# user-onboarding Specification

## Purpose
定义 Hagicode Desktop 的新用户首次使用引导流程，确保新用户能够顺利完成初始配置并快速上手使用应用程序。

## ADDED Requirements

### Requirement: 引导流程触发条件

应用 MUST 在满足以下条件时自动触发首次使用引导流程。

#### Scenario: 首次安装触发引导

**Given** 用户新安装 Hagicode Desktop
**And** 首次启动应用
**When** 应用完成初始化
**Then** 检查 electron-store 中的引导状态
**And** 检查是否有已安装的 Hagicode Server 版本
**And** 如果引导未完成且无已安装版本，自动显示引导向导

#### Scenario: 已有安装不触发引导

**Given** 用户已安装并使用过 Hagicode Desktop
**And** 至少有一个已安装的 Hagicode Server 版本
**When** 用户启动应用
**Then** 不显示引导向导
**And** 直接进入主界面

#### Scenario: 跳过后不再触发

**Given** 用户之前已跳过引导流程
**And** electron-store 中 isSkipped 为 true
**When** 用户启动应用
**Then** 不显示引导向导
**And** 直接进入主界面

---

### Requirement: 引导流程步骤

引导流程 MUST 包含四个明确的步骤，按顺序引导用户完成首次配置。

#### Scenario: 步骤 1 - 应用介绍

**Given** 引导向导已显示
**When** 用户处于第一步
**Then** 显示欢迎标题和 Hagicode Desktop 介绍
**And** 显示核心功能列表（管理安装、启动停止、依赖管理、配置设置）
**And** 显示首次安装流程概述（下载、安装依赖、启动服务）
**And** 显示预计完成时间
**And** 提供"开始安装"按钮
**And** 提供"取消"按钮

#### Scenario: 步骤 2 - 下载最新包

**Given** 用户完成第一步并点击"开始安装"
**When** 进入第二步
**Then** 从官方网站获取最新的 Hagicode Server 版本信息
**And** 显示版本号和文件大小
**And** 开始下载并显示下载进度（0-100%）
**And** 显示已下载大小/总大小
**And** 显示下载速度和预计剩余时间
**And** 下载完成后显示完成状态
**And** 启用"下一步"按钮
**And** 提供"上一步"按钮返回第一步

#### Scenario: 步骤 3 - 安装依赖项

**Given** 用户完成第二步并点击"下一步"
**When** 进入第三步
**Then** 检测并显示所有需要的系统依赖项
**And** 为每个依赖项显示状态（已安装/安装中/待安装）
**And** 自动安装缺失的依赖项
**And** 显示当前安装的依赖项名称和进度
**And** 显示总体安装进度
**And** 所有依赖安装完成后显示完成状态
**And** 启用"下一步"按钮
**And** 提供"上一步"按钮返回第二步

#### Scenario: 步骤 4 - 启动服务

**Given** 用户完成第三步并点击"下一步"
**When** 进入第四步
**Then** 启动已安装的 Hagicode Server
**And** 显示服务启动进度
**And** 显示当前启动阶段信息
**And** 显示安装信息摘要（版本、数据目录、端口）
**And** 服务启动成功后显示完成界面
**And** 显示技术支持信息（文档链接、问题反馈链接）
**And** 提供"进入主界面"按钮
**And** 提供"上一步"按钮返回第三步

---

### Requirement: 引导流程导航

用户 MUST 能够在引导流程中进行灵活的步骤导航。

#### Scenario: 下一步导航

**Given** 用户在引导流程的某个步骤
**When** 当前步骤完成且用户点击"下一步"按钮
**Then** 进入下一个步骤
**And** 更新进度指示器
**And** 如果是最后一步，按钮文本变为"进入主界面"

#### Scenario: 上一步导航

**Given** 用户不在第一步
**When** 用户点击"上一步"按钮
**Then** 返回上一个步骤
**And** 恢复上一步的状态
**And** 更新进度指示器

#### Scenario: 第一步禁用上一步

**Given** 用户在第一步（应用介绍）
**When** 第一步显示中
**Then** "上一步"按钮被禁用
**And** "下一步"按钮文本为"开始安装"

#### Scenario: 未完成步骤禁用下一步

**Given** 用户在某个步骤
**When** 当前步骤的操作尚未完成
**Then** "下一步"按钮被禁用
**And** 显示相应的提示（如"正在下载中..."）

---

### Requirement: 引导流程跳过功能

用户 MUST 能够选择跳过引导流程，并能在需要时重新启用。

#### Scenario: 显示跳过选项

**Given** 引导向导已显示
**When** 用户查看引导界面
**Then** 在引导界面底部显示"不再显示此引导"复选框

#### Scenario: 跳过确认对话框

**Given** 用户勾选"不再显示此引导"复选框
**When** 用户尝试关闭引导或点击取消
**Then** 显示跳过确认对话框
**And** 对话框说明跳过后的操作方式
**And** 提供"取消"和"跳过引导"按钮

#### Scenario: 确认跳过

**Given** 跳过确认对话框已显示
**When** 用户点击"跳过引导"按钮
**Then** 保存跳过状态到 electron-store（isSkipped = true）
**And** 关闭引导向导
**And** 进入主界面
**And** 后续启动不再显示引导

#### Scenario: 取消跳过

**Given** 跳过确认对话框已显示
**When** 用户点击"取消"按钮或关闭对话框
**Then** 不保存跳过状态
**And** 引导向导继续显示

#### Scenario: 从设置重新启用引导

**Given** 用户之前已跳过引导流程
**When** 用户在设置中选择"重新显示引导流程"
**Then** 重置 electron-store 中的引导状态
**And** 下次启动应用时显示引导向导

---

### Requirement: 引导进度可视化

引导流程 MUST 提供清晰的进度指示，让用户了解当前位置和剩余步骤。

#### Scenario: 步骤进度指示器

**Given** 引导向导已显示
**When** 用户在任何步骤
**Then** 在引导界面顶部显示进度指示器
**And** 进度指示器显示 4 个圆点，代表 4 个步骤
**And** 当前步骤的圆点高亮显示
**And** 已完成步骤的圆点显示为已完成状态
**And** 未完成步骤的圆点显示为未完成状态

#### Scenario: 下载进度显示

**Given** 用户在下载包步骤
**When** 下载进行中
**Then** 显示下载进度条（0-100%）
**And** 显示百分比数字
**And** 显示已下载大小和总大小（如 30.5 MB / 45.8 MB）
**And** 显示下载速度（如 2.3 MB/s）
**And** 显示预计剩余时间（如约 7 秒）

#### Scenario: 依赖安装进度显示

**Given** 用户在安装依赖步骤
**When** 依赖安装进行中
**Then** 显示依赖项列表，每个项显示名称和状态
**And** 已安装的项显示"✓ 已安装"和版本号
**And** 安装中的项显示进度条和百分比
**And** 待安装的项显示"○ 待安装"
**And** 显示总体安装进度

---

### Requirement: 引导状态持久化

引导流程的状态和用户选择 MUST 被持久化存储，确保应用重启后状态保持一致。

#### Scenario: 保存引导完成状态

**Given** 用户完成所有引导步骤
**When** 用户点击"进入主界面"按钮
**Then** 保存引导完成状态到 electron-store（isCompleted = true）
**And** 保存当前步骤为完成状态
**And** 后续启动不再显示引导

#### Scenario: 保存跳过状态

**Given** 用户确认跳过引导流程
**When** 跳过操作执行
**Then** 保存跳过状态到 electron-store（isSkipped = true）
**And** 后续启动不再显示引导

#### Scenario: 保存当前步骤状态

**Given** 用户在引导流程中
**When** 用户切换步骤或关闭引导
**Then** 保存当前步骤到 electron-store（currentStep）
**And** 保存引导激活状态（isActive）
**And** 应用重启后可恢复到之前的步骤

#### Scenario: 状态恢复

**Given** 用户之前中断了引导流程
**And** electron-store 中有未完成的引导状态
**When** 用户重新启动应用
**Then** 询问用户是否继续之前的引导流程
**And** 如果选择继续，恢复到中断的步骤
**And** 如果选择重新开始，重置引导状态

---

### Requirement: 错误处理和恢复

引导流程 MUST 能够优雅地处理各种错误情况，并提供明确的恢复路径。

#### Scenario: 下载失败处理

**Given** 用户在下载包步骤
**When** 下载失败（网络错误、服务器错误等）
**Then** 显示友好的错误消息
**And** 错误消息包含具体的失败原因
**And** 提供"重试"按钮
**And** 提供"取消"按钮
**And** 清理已下载的部分文件

#### Scenario: 依赖安装失败处理

**Given** 用户在安装依赖步骤
**When** 某个依赖安装失败
**Then** 显示错误对话框
**And** 说明哪个依赖安装失败
**And** 提供解决方案建议
**And** 提供"重试"按钮
**And** 提供"跳过此依赖"按钮（如果可选）
**And** 提供"取消"按钮

#### Scenario: 服务启动失败处理

**Given** 用户在启动服务步骤
**When** 服务启动失败
**Then** 显示错误对话框
**And** 显示错误详情和日志
**And** 提供故障排查建议
**And** 提供"重试"按钮
**And** 提供"查看日志"按钮
**And** 提供"手动启动"按钮（跳过自动启动）

#### Scenario: 网络中断恢复

**Given** 用户在下载包步骤
**When** 网络连接中断
**Then** 暂停下载并显示网络错误提示
**And** 提供恢复下载选项
**And** 网络恢复后可从断点继续下载
**And** 如果无法恢复，提供重新下载选项

---

### Requirement: 国际化支持

引导流程界面 MUST 支持多语言，包括中文和英文。

#### Scenario: 中文界面

**Given** 用户选择中文语言
**When** 引导向导显示
**Then** 所有界面元素使用中文显示
**And** 步骤标题和内容使用中文
**And** 按钮文本使用中文
**And** 提示信息和错误消息使用中文

#### Scenario: 英文界面

**Given** 用户选择英文语言
**When** 引导向导显示
**Then** 所有界面元素使用英文显示
**And** 步骤标题和内容使用英文
**And** 按钮文本使用英文
**And** 提示信息和错误消息使用英文

#### Scenario: 语言切换

**Given** 用户在引导流程中
**When** 用户切换应用语言
**Then** 引导界面实时更新为新语言
**And** 不影响引导流程进度

---

### Requirement: 可访问性支持

引导流程 MUST 符合可访问性标准，确保所有用户都能使用。

#### Scenario: 键盘导航

**Given** 引导向导已显示
**When** 用户使用键盘操作
**Then** 可以使用 Tab 键在所有交互元素间导航
**And** 可以使用 Enter 键激活按钮
**And** 可以使用 Esc 键取消操作或关闭对话框

#### Scenario: 屏幕阅读器支持

**Given** 用户使用屏幕阅读器
**When** 引导向导显示
**Then** 所有界面元素有正确的 ARIA 标签
**And** 进度变化有适当的语音提示
**And** 错误消息能被屏幕阅读器读取

#### Scenario: 高对比度模式

**Given** 用户启用系统高对比度模式
**When** 引导向导显示
**Then** 界面颜色适应高对比度模式
**And** 所有文本清晰可读
**And** 交互元素状态明显可辨
