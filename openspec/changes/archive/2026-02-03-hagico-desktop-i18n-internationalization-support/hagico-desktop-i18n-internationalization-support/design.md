# å›½é™…åŒ–æ¶æ„è®¾è®¡æ–‡æ¡£

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿° Hagicode Desktop å›½é™…åŒ–ï¼ˆi18nï¼‰ç³»ç»Ÿçš„æŠ€æœ¯æ¶æ„ã€è®¾è®¡å†³ç­–å’Œå®ç°ç»†èŠ‚ã€‚

## æ¶æ„æ¦‚è§ˆ

### ç³»ç»Ÿç»„ä»¶å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         User Interface                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Components  â”‚  â”‚  Pages       â”‚  â”‚ LanguageSelector â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                â”‚                    â”‚             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                          â”‚                                  â”‚
â”‚                   useTranslation()                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      i18next Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ I18nextProviderâ”‚ â”‚ i18n Instanceâ”‚ â”‚  i18next Config  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                  â”‚
â”‚                   Translation Resources                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ common  â”‚  â”‚component â”‚  â”‚  pages  â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    State Management                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Redux Store                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ i18nSlice   â”‚  â”‚ otherSlices  â”‚  â”‚ rootState  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  ï¿½â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚ setCurrentLanguage(language)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Persistence Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              electron-store                          â”‚   â”‚
â”‚  â”‚  Key: appSettings.language                           â”‚   â”‚
â”‚  â”‚  Value: 'zh-CN' | 'en-US' | ...                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 1. i18next é…ç½®

#### æ–‡ä»¶ç»“æ„
```
src/renderer/i18n/
â”œâ”€â”€ index.ts              # å¯¼å‡º i18n å®ä¾‹
â”œâ”€â”€ config.ts             # é…ç½®å¸¸é‡
â””â”€â”€ locales/
    â”œâ”€â”€ zh-CN/
    â”‚   â”œâ”€â”€ common.json
    â”‚   â”œâ”€â”€ components.json
    â”‚   â””â”€â”€ pages.json
    â””â”€â”€ en-US/
        â”œâ”€â”€ common.json
        â”œâ”€â”€ components.json
        â””â”€â”€ pages.json
```

#### é…ç½®å‚æ•°

```typescript
// src/renderer/i18n/config.ts
export const i18nConfig = {
  // é»˜è®¤è¯­è¨€
  lng: 'zh-CN',

  // å›é€€è¯­è¨€é“¾
  fallbackLng: {
    default: ['en-US'],
    'zh-HK': ['zh-CN', 'en-US'],
    'zh-TW': ['zh-CN', 'en-US'],
  },

  // é»˜è®¤å‘½åç©ºé—´
  defaultNS: 'common',

  // å¯ç”¨å‘½åç©ºé—´
  ns: ['common', 'components', 'pages'],

  // å‘½åç©ºé—´åŠ è½½é¡ºåº
  nsSeparator: ':',

  // é”®ååˆ†éš”ç¬¦
  keySeparator: '.',

  // æ’å€¼é…ç½®
  interpolation: {
    escapeValue: false, // React å·²ç»è½¬ä¹‰
    formatSeparator: ',',
    format: (value, format) => {
      // è‡ªå®šä¹‰æ ¼å¼åŒ–é€»è¾‘
      if (format === 'uppercase') return value.toUpperCase();
      if (format === 'lowercase') return value.toLowerCase();
      return value;
    },
  },

  // React ç‰¹å®šé…ç½®
  react: {
    useSuspense: false, // ç¦ç”¨ Suspenseï¼Œé¿å…é˜»å¡æ¸²æŸ“
    bindI18n: 'languageChanged',
    bindI18nStore: 'added',
    transEmptyNodeValue: '',
    transSupportBasicHtmlNodes: true,
    transKeepBasicHtmlNodesFor: ['br', 'strong', 'i', 'p'],
  },

  // æ£€æµ‹å’Œç¼“å­˜
  detection: {
    order: ['store', 'navigator'],
    caches: ['store'],
  },

  // è°ƒè¯•æ¨¡å¼ï¼ˆç”Ÿäº§ç¯å¢ƒè®¾ä¸º falseï¼‰
  debug: process.env.NODE_ENV === 'development',

  // åŠ è½½ç­–ç•¥
  backend: {
    loadPath: '/locales/{{lng}}/{{ns}}.json',
  },

  // ä¿å­˜ç¼ºå¤±çš„ç¿»è¯‘é”®ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
  saveMissing: process.env.NODE_ENV === 'development',
  saveMissingTo: 'current',
  missingKeyHandler: (lng, ns, key) => {
    console.warn(`Missing translation key: ${lng}:${ns}:${key}`);
  },
};
```

### 2. Redux çŠ¶æ€ç®¡ç†

#### State ç»“æ„

```typescript
// src/renderer/store/slices/i18nSlice.ts

interface Language {
  code: string;        // ISO 639-1 è¯­è¨€ä»£ç  + ISO 3166-1 å›½å®¶ä»£ç 
  name: string;        // è‹±æ–‡åç§°ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰
  nativeName: string;  // æœ¬åœ°è¯­è¨€åç§°ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰
  flag?: string;       // Emoji å›½æ——ï¼ˆå¯é€‰ï¼‰
}

interface I18nState {
  currentLanguage: string;           // å½“å‰è¯­è¨€ä»£ç 
  availableLanguages: Language[];    // å¯ç”¨è¯­è¨€åˆ—è¡¨
  isLoading: boolean;                // åŠ è½½çŠ¶æ€
  error: string | null;              // é”™è¯¯ä¿¡æ¯
}

const initialState: I18nState = {
  currentLanguage: 'zh-CN',
  availableLanguages: [
    {
      code: 'zh-CN',
      name: 'Simplified Chinese',
      nativeName: 'ç®€ä½“ä¸­æ–‡',
      flag: 'ğŸ‡¨ğŸ‡³',
    },
    {
      code: 'en-US',
      name: 'English',
      nativeName: 'English',
      flag: 'ğŸ‡ºğŸ‡¸',
    },
  ],
  isLoading: false,
  error: null,
};
```

#### Actions å’Œ Reducers

```typescript
import { createSlice, PayloadAction } from '@reduxjs/toolkit';

const i18nSlice = createSlice({
  name: 'i18n',
  initialState,
  reducers: {
    setCurrentLanguage: (state, action: PayloadAction<string>) => {
      state.currentLanguage = action.payload;
    },
    setAvailableLanguages: (state, action: PayloadAction<Language[]>) => {
      state.availableLanguages = action.payload;
    },
    setLoading: (state, action: PayloadAction<boolean>) => {
      state.isLoading = action.payload;
    },
    setError: (state, action: PayloadAction<string | null>) => {
      state.error = action.payload;
    },
  },
});

export const {
  setCurrentLanguage,
  setAvailableLanguages,
  setLoading,
  setError,
} = i18nSlice.actions;

export default i18nSlice.reducer;

// Selectors
export const selectCurrentLanguage = (state: RootState) =>
  state.i18n.currentLanguage;

export const selectAvailableLanguages = (state: RootState) =>
  state.i18n.availableLanguages;
```

#### Saga é›†æˆ

```typescript
// src/renderer/store/sagas/i18nSaga.ts

import { put, takeEvery, call, select } from 'redux-saga/effects';
import { setCurrentLanguage } from '../slices/i18nSlice';
import i18n from '../../i18n';

// ç›‘å¬è¯­è¨€åˆ‡æ¢ action
function* changeLanguageSaga(action: PayloadAction<string>) {
  const language = action.payload;

  try {
    // è°ƒç”¨ i18next åˆ‡æ¢è¯­è¨€
    yield call([i18n, 'changeLanguage'], language);

    // æ›´æ–° Redux state
    yield put(setCurrentLanguage(language));

    // æŒä¹…åŒ–åˆ° electron-store
    if (window.electronAPI?.setLanguage) {
      yield call([window.electronAPI, 'setLanguage'], language);
    }
  } catch (error) {
    console.error('Failed to change language:', error);
  }
}

// åº”ç”¨å¯åŠ¨æ—¶åŠ è½½è¯­è¨€åå¥½
function* loadInitialLanguageSaga() {
  try {
    // ä» electron-store è¯»å–
    const savedLanguage =
      window.electronAPI?.getLanguage &&
      (yield call([window.electronAPI, 'getLanguage']));

    if (savedLanguage) {
      yield call([i18n, 'changeLanguage'], savedLanguage);
      yield put(setCurrentLanguage(savedLanguage));
    }
  } catch (error) {
    console.error('Failed to load initial language:', error);
  }
}

export function* i18nSaga() {
  yield takeEvery('i18n/changeLanguageRequest', changeLanguageSaga);
  yield takeEvery('i18n/loadInitialLanguage', loadInitialLanguageSaga);
}
```

### 3. ç¿»è¯‘èµ„æºç®¡ç†

#### å‘½åç©ºé—´åˆ’åˆ†åŸåˆ™

| å‘½åç©ºé—´ | ç”¨é€” | ç¤ºä¾‹é”® |
|---------|------|--------|
| `common` | é€šç”¨ UI æ–‡æœ¬ï¼Œè·¨ç»„ä»¶å¤ç”¨ | `common.button.save`, `common.status.loading` |
| `components` | ç»„ä»¶ç‰¹å®šæ–‡æœ¬ | `components.packageManagement.cardTitle` |
| `pages` | é¡µé¢çº§æ–‡æœ¬ | `pages.settings.title` |

#### ç¿»è¯‘é”®å‘½åè§„èŒƒ

**æ ¼å¼**ï¼š`category.entity.attribute`

**ç¤ºä¾‹**ï¼š
```json
{
  "components": {
    "packageManagement": {
      "cardTitle": "åŒ…ç®¡ç†",
      "cardDescription": "ç®¡ç† Web æœåŠ¡åŒ…çš„å®‰è£…",
      "installStatus": {
        "installed": "å·²å®‰è£…",
        "notInstalled": "æœªå®‰è£…"
      },
      "versionLabel": "ç‰ˆæœ¬",
      "installButton": "å®‰è£…åŒ…",
      "installingButton": "å®‰è£…ä¸­..."
    }
  }
}
```

#### ç¿»è¯‘èµ„æºç¤ºä¾‹

```json
// src/renderer/i18n/locales/zh-CN/common.json
{
  "button": {
    "save": "ä¿å­˜",
    "cancel": "å–æ¶ˆ",
    "confirm": "ç¡®è®¤",
    "delete": "åˆ é™¤",
    "edit": "ç¼–è¾‘",
    "close": "å…³é—­",
    "refresh": "åˆ·æ–°",
    "install": "å®‰è£…",
    "uninstall": "å¸è½½"
  },
  "status": {
    "loading": "åŠ è½½ä¸­...",
    "success": "æˆåŠŸ",
    "error": "é”™è¯¯",
    "warning": "è­¦å‘Š",
    "info": "ä¿¡æ¯"
  },
  "form": {
    "required": "å¿…å¡«",
    "optional": "å¯é€‰",
    "selectPlaceholder": "è¯·é€‰æ‹©...",
    "inputPlaceholder": "è¯·è¾“å…¥..."
  }
}

// src/renderer/i18n/locales/zh-CN/components.json
{
  "packageManagement": {
    "cardTitle": "åŒ…ç®¡ç†",
    "cardDescription": "ç®¡ç† Web æœåŠ¡åŒ…çš„å®‰è£…",
    "platformLabel": "å¹³å°",
    "installationStatusLabel": "å®‰è£…çŠ¶æ€",
    "installedVersionLabel": "å·²å®‰è£…ç‰ˆæœ¬",
    "selectVersionLabel": "é€‰æ‹©è¦å®‰è£…çš„ç‰ˆæœ¬",
    "versionPlaceholder": "-- é€‰æ‹©ç‰ˆæœ¬ --",
    "installingProgress": "å®‰è£…ä¸­...",
    "noPackagesMessage": "æ²¡æœ‰å¯ç”¨çš„åŒ…ã€‚è¯·ç¡®ä¿åŒ…æºç›®å½•å­˜åœ¨äºï¼š",
    "availableVersionsCount": "å¯ç”¨ç‰ˆæœ¬ï¼šæ‰¾åˆ° {{count}} ä¸ª"
  },
  "webServiceStatus": {
    "cardTitle": "Web æœåŠ¡çŠ¶æ€",
    "cardDescription": "æŸ¥çœ‹å’Œç®¡ç† Web æœåŠ¡è¿è¡ŒçŠ¶æ€"
  }
}
```

#### æ’å€¼å’Œå¤æ•°æ”¯æŒ

```json
{
  "message": {
    "welcome": "æ¬¢è¿ï¼Œ{{name}}ï¼",
    "itemCount_one": "{{count}} ä¸ªé¡¹ç›®",
    "itemCount_other": "{{count}} ä¸ªé¡¹ç›®"
  }
}
```

### 4. ç»„ä»¶é›†æˆæ¨¡å¼

#### åŸºç¡€ç”¨æ³•

```typescript
import React from 'react';
import { useTranslation } from 'react-i18next';

const PackageManagementCard: React.FC = () => {
  const { t } = useTranslation('components');

  return (
    <Card>
      <CardHeader>
        <CardTitle>{t('packageManagement.cardTitle')}</CardTitle>
        <CardDescription>
          {t('packageManagement.cardDescription')}
        </CardDescription>
      </CardHeader>
      {/* ... */}
    </Card>
  );
};
```

#### å¤šå‘½åç©ºé—´

```typescript
const { t } = useTranslation(['common', 'components']);

t('common.button.save');
t('components.packageManagement.cardTitle');
```

#### æ’å€¼

```typescript
t('message.welcome', { name: 'John' });
// è¾“å‡ºï¼šæ¬¢è¿ï¼ŒJohnï¼
```

#### åŠ¨æ€é”®å

```typescript
const status = 'installed';
t(`packageManagement.installStatus.${status}`);
// å½“ status = 'installed' æ—¶ï¼Œè¾“å‡ºï¼šå·²å®‰è£…
```

### 5. è¯­è¨€é€‰æ‹©å™¨ç»„ä»¶

#### ç»„ä»¶è®¾è®¡

```typescript
// src/renderer/components/settings/LanguageSelector.tsx

import React from 'react';
import { useTranslation } from 'react-i18next';
import { useSelector, useDispatch } from 'react-redux';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { Label } from '@/components/ui/label';
import { RootState, AppDispatch } from '@/store';
import { selectCurrentLanguage, selectAvailableLanguages } from '@/store/slices/i18nSlice';
import { changeLanguageRequest } from '@/store/sagas/i18nSaga';

export const LanguageSelector: React.FC = () => {
  const { t, i18n } = useTranslation('pages');
  const dispatch = useDispatch<AppDispatch>();
  const currentLanguage = useSelector(selectCurrentLanguage);
  const availableLanguages = useSelector(selectAvailableLanguages);

  const handleLanguageChange = (languageCode: string) => {
    dispatch(changeLanguageRequest(languageCode));
  };

  return (
    <div className="space-y-2">
      <Label htmlFor="language-selector">
        {t('settings.language.label')}
      </Label>
      <Select
        value={currentLanguage}
        onValueChange={handleLanguageChange}
      >
        <SelectTrigger id="language-selector">
          <SelectValue />
        </SelectTrigger>
        <SelectContent>
          {availableLanguages.map((lang) => (
            <SelectItem key={lang.code} value={lang.code}>
              <span className="mr-2">{lang.flag}</span>
              <span>{lang.nativeName}</span>
              <span className="text-muted-foreground ml-2">
                ({lang.name})
              </span>
            </SelectItem>
          ))}
        </SelectContent>
      </Select>
    </div>
  );
};
```

#### UI è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¯­è¨€                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡ (Simplified Chinese)   â”‚ â”‚
â”‚ â”‚   â–¼                                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚   ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡ (Simplified Chinese)     â”‚
â”‚   ğŸ‡ºğŸ‡¸ English (English)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6. æŒä¹…åŒ–æœºåˆ¶

#### Electron Store Schema

```typescript
// src/main/store.ts

import Store from 'electron-store';

interface AppSettings {
  language: string;
  // ... å…¶ä»–è®¾ç½®
}

interface StoreSchema {
  appSettings: AppSettings;
}

const store = new Store<StoreSchema>({
  defaults: {
    appSettings: {
      language: 'zh-CN',
    },
  },
});

export default store;
```

#### IPC é€šä¿¡

```typescript
// src/main/ipc.ts

import { ipcMain } from 'electron';
import store from './store';

ipcMain.handle('get-language', () => {
  return store.get('appSettings.language');
});

ipcMain.handle('set-language', (_event, language: string) => {
  store.set('appSettings.language', language);
  return language;
});
```

```typescript
// src/preload/index.d.ts

export interface ElectronAPI {
  getLanguage: () => Promise<string>;
  setLanguage: (language: string) => Promise<string>;
}
```

## æ•°æ®æµè®¾è®¡

### è¯­è¨€åˆ‡æ¢æµç¨‹

```mermaid
sequenceDiagram
    participant U as User
    participant UI as LanguageSelector
    participant Redux as Redux Store
    participant I18n as i18next
    participant ES as Electron Store

    U->>UI: é€‰æ‹©è¯­è¨€
    UI->>Redux: dispatch(changeLanguageRequest('zh-CN'))
    Redux->>I18n: i18n.changeLanguage('zh-CN')
    I18n-->>Redux: è¯­è¨€åˆ‡æ¢å®Œæˆ
    Redux->>Redux: setCurrentLanguage('zh-CN')
    Redux->>ES: setLanguage('zh-CN')
    ES-->>Redux: ä¿å­˜æˆåŠŸ
    Redux-->>UI: State æ›´æ–°
    UI->>U: ç•Œé¢æ–‡æœ¬æ›´æ–°
```

### åº”ç”¨å¯åŠ¨è¯­è¨€åŠ è½½æµç¨‹

```mermaid
sequenceDiagram
    participant App as App Start
    participant Redux as Redux Store
    participant ES as Electron Store
    participant I18n as i18next
    participant UI as Components

    App->>Redux: åˆå§‹åŒ– Redux Store
    Redux->>ES: getLanguage()
    ES-->>Redux: è¿”å› 'zh-CN'
    Redux->>I18n: changeLanguage('zh-CN')
    I18n-->>Redux: å®Œæˆ
    Redux-->>UI: æ¸²æŸ“ç»„ä»¶
    UI->>I18n: t('components.packageManagement.cardTitle')
    I18n-->>UI: è¿”å› "åŒ…ç®¡ç†"
    UI->>U: æ˜¾ç¤ºä¸­æ–‡ç•Œé¢
```

## æ‰©å±•æ€§è®¾è®¡

### æ·»åŠ æ–°è¯­è¨€

**æ­¥éª¤**ï¼š

1. åˆ›å»ºæ–°çš„è¯­è¨€ç›®å½•ï¼š
   ```
   src/renderer/i18n/locales/ja-JP/
   ```

2. åˆ›å»ºç¿»è¯‘èµ„æºæ–‡ä»¶ï¼š
   ```
   common.json, components.json, pages.json
   ```

3. æ›´æ–° `i18nSlice` ä¸­çš„å¯ç”¨è¯­è¨€åˆ—è¡¨ï¼š
   ```typescript
   {
     code: 'ja-JP',
     name: 'Japanese',
     nativeName: 'æ—¥æœ¬èª',
     flag: 'ğŸ‡¯ğŸ‡µ',
   }
   ```

4. i18next ä¼šè‡ªåŠ¨åŠ è½½æ–°è¯­è¨€èµ„æº

### åŠ¨æ€åŠ è½½è¯­è¨€åŒ…ï¼ˆæœªæ¥æ‰©å±•ï¼‰

```typescript
// åŠ¨æ€å¯¼å…¥è¯­è¨€åŒ…
const loadLanguage = async (lng: string) => {
  const resources = await import(`./locales/${lng}/index.ts`);
  i18n.addResourceBundle(lng, 'common', resources.common);
  i18n.addResourceBundle(lng, 'components', resources.components);
  i18n.addResourceBundle(lng, 'pages', resources.pages);
};
```

### ç¿»è¯‘ç®¡ç†å·¥å…·ï¼ˆæœªæ¥æ‰©å±•ï¼‰

```typescript
// ç¿»è¯‘èµ„æºæå– CLI
npm run extract-i18n

// ç¿»è¯‘å®Œæ•´æ€§æ£€æŸ¥
npm run check-i18n

// ç¿»è¯‘èµ„æºåŒæ­¥
npm run sync-i18n
```

## æ€§èƒ½ä¼˜åŒ–

### èµ„æºæ‡’åŠ è½½

- æŒ‰å‘½åç©ºé—´åŠ¨æ€åŠ è½½ç¿»è¯‘èµ„æº
- ä»…åŠ è½½å½“å‰è¯­è¨€å’Œå›é€€è¯­è¨€çš„èµ„æº

### ç¼“å­˜ç­–ç•¥

- ä½¿ç”¨ i18next å†…ç½®çš„èµ„æºç¼“å­˜
- IndexedDB æŒä¹…åŒ–ç¼“å­˜ï¼ˆå¯é€‰ï¼‰

### æ¸²æŸ“ä¼˜åŒ–

- ä½¿ç”¨ React.memo é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
- i18n state å˜åŒ–æ—¶ä»…é‡æ¸²æŸ“å—å½±å“çš„ç»„ä»¶

```typescript
export const PackageManagementCard = React.memo(() => {
  const { t } = useTranslation('components');
  // ...
});
```

## æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

```typescript
// i18nSlice.test.ts
describe('i18nSlice', () => {
  it('should set current language', () => {
    const state = i18nReducer(initialState, setCurrentLanguage('en-US'));
    expect(state.currentLanguage).toBe('en-US');
  });
});
```

### é›†æˆæµ‹è¯•

```typescript
// LanguageSelector.test.tsx
describe('LanguageSelector', () => {
  it('should change language when selection changes', () => {
    const { getByRole } = render(<LanguageSelector />);
    const select = getByRole('combobox');
    fireEvent.change(select, { target: { value: 'en-US' } });
    expect(i18n.language).toBe('en-US');
  });
});
```

### E2E æµ‹è¯•

```typescript
// e2e/i18n.spec.ts
test('should persist language preference', async ({ app, electronApp }) => {
  const window = await app.firstWindow();
  await window.selectOption('#language-selector', 'en-US');
  await electronApp.close();

  // é‡å¯åº”ç”¨
  const app2 = await electronApp.launch({ ...appOptions });
  const window2 = await app2.firstWindow();
  const selectedLang = await window2.inputValue('#language-selector');
  expect(selectedLang).toBe('en-US');
});
```

## å®‰å…¨è€ƒè™‘

### ç¿»è¯‘èµ„æºéªŒè¯

- éªŒè¯ JSON æ ¼å¼æ­£ç¡®æ€§
- é˜²æ­¢é€šè¿‡ç¿»è¯‘é”®æ³¨å…¥æ¶æ„ä»£ç 
- é™åˆ¶ç¿»è¯‘èµ„æºå¤§å°ï¼Œé˜²æ­¢ DoS

### è¾“å…¥è½¬ä¹‰

- i18next é»˜è®¤è½¬ä¹‰æ’å€¼å˜é‡
- HTML å†…å®¹éœ€æ˜ç¡®é…ç½®ä½¿ç”¨ trans ç»„ä»¶

## æ•…éšœå¤„ç†

### ç¼ºå¤±ç¿»è¯‘é”®

```typescript
// å¼€å‘æ¨¡å¼ï¼šè®°å½•è­¦å‘Š
missingKeyHandler: (lng, ns, key) => {
  console.warn(`Missing translation: ${lng}:${ns}:${key}`);
},

// ç”Ÿäº§æ¨¡å¼ï¼šè¿”å›å›é€€è¯­è¨€çš„ç¿»è¯‘æˆ–é”®å
```

### èµ„æºåŠ è½½å¤±è´¥

```typescript
// ä½¿ç”¨å›é€€è¯­è¨€
i18n.changeLanguage('zh-CN').catch(() => {
  i18n.changeLanguage('en-US');
});
```

### æŒä¹…åŒ–å¤±è´¥

```typescript
// é™çº§åˆ°é»˜è®¤è¯­è¨€
try {
  await window.electronAPI.setLanguage(language);
} catch (error) {
  console.error('Failed to save language preference:', error);
  // ç»§ç»­ä½¿ç”¨ï¼Œä»…ä¸ä¿å­˜åå¥½
}
```

## ç›‘æ§å’Œæ—¥å¿—

### å…³é”®æŒ‡æ ‡

- å½“å‰è¯­è¨€åˆ†å¸ƒï¼ˆé€šè¿‡é”™è¯¯æŠ¥å‘Šæˆ–ä½¿ç”¨ç»Ÿè®¡ï¼‰
- ç¼ºå¤±ç¿»è¯‘é”®é¢‘ç‡
- è¯­è¨€åˆ‡æ¢æˆåŠŸç‡
- åŠ è½½æ—¶é—´

### æ—¥å¿—è®°å½•

```typescript
// è®°å½•è¯­è¨€åˆ‡æ¢
logger.info('Language changed', {
  from: previousLanguage,
  to: newLanguage,
  timestamp: Date.now(),
});

// è®°å½•ç¼ºå¤±ç¿»è¯‘
logger.warn('Missing translation key', {
  key,
  namespace,
  language,
});
```
